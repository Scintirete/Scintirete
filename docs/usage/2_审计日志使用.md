# å®¡è®¡æ—¥å¿—ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

Scintirete æä¾›äº†ç®€å•è€Œæœ‰æ•ˆçš„å®¡è®¡æ—¥å¿—åŠŸèƒ½ï¼Œç”¨äºè®°å½•æ‰€æœ‰é‡è¦çš„æ•°æ®åº“æ“ä½œï¼Œæ»¡è¶³åˆè§„å’Œè°ƒè¯•éœ€æ±‚ã€‚

## åŠŸèƒ½ç‰¹æ€§

### âœ… **å·²æ”¯æŒçš„æ“ä½œ**
- **æ•°æ®åº“ç®¡ç†**: `CreateDatabase`, `DropDatabase`
- **é›†åˆç®¡ç†**: `CreateCollection`, `DropCollection`
- **å‘é‡æ•°æ®**: `InsertVectors`, `DeleteVectors`
- **è¾…åŠ©æ“ä½œ**: `EmbedAndInsert`

### ğŸ“ **æ—¥å¿—æ ¼å¼**
```json
{
  "timestamp": "2025-07-20T14:31:08.204977Z",
  "level": "OPERATION",
  "operation": "CreateDatabase",
  "database": "test_db",
  "collection": "test_coll",
  "user_id": "user_c638833",
  "success": true,
  "metadata": {
    "operation_type": "database_management",
    "vector_count": 100
  }
}
```

## é…ç½®

### å¯ç”¨å®¡è®¡æ—¥å¿—
åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼š
```toml
[server]
enable_audit_log = true
```

### æ—¥å¿—æ–‡ä»¶ä½ç½®
å®¡è®¡æ—¥å¿—è‡ªåŠ¨ä¿å­˜åœ¨ï¼š
```
{data_dir}/audit.log
```

### æ—¥å¿—è½®è½¬
- **æœ€å¤§æ–‡ä»¶å¤§å°**: 10MB
- **ä¿ç•™æ–‡ä»¶æ•°**: 5ä¸ª
- **è‡ªåŠ¨è½®è½¬**: å½“æ–‡ä»¶è¶…è¿‡é™åˆ¶æ—¶è‡ªåŠ¨åˆ›å»ºæ–°æ–‡ä»¶

## ç”¨æˆ·è¯†åˆ«

ç³»ç»Ÿä½¿ç”¨å¯†ç å“ˆå¸Œç”Ÿæˆç®€åŒ–çš„ç”¨æˆ·æ ‡è¯†ï¼š
- **æ ¼å¼**: `user_xxxxxxxx` (8ä½å“ˆå¸Œ)
- **éšç§ä¿æŠ¤**: ä¸ç›´æ¥å­˜å‚¨å¯†ç 
- **å”¯ä¸€æ€§**: ç›¸åŒå¯†ç äº§ç”Ÿç›¸åŒID

## å…ƒæ•°æ®è¯´æ˜

### æ•°æ®åº“æ“ä½œ
```json
{
  "operation_type": "database_management"
}
```

### é›†åˆæ“ä½œ
```json
{
  "operation_type": "collection_management",
  "metric_type": "L2",
  "hnsw_params": {...}
}
```

### å‘é‡æ“ä½œ
```json
{
  "operation_type": "vector_data",
  "vector_count": 100,
  "requested_count": 50,
  "actual_deleted": 45
}
```

### è¾…åŠ©æ“ä½œ
```json
{
  "operation_type": "auxiliary",
  "embedding_model": "text-embedding-ada-002",
  "text_count": 10,
  "vector_count": 10
}
```

## æœ€ä½³å®è·µ

1. **å®šæœŸå¤‡ä»½**: å®¡è®¡æ—¥å¿—åŒ…å«é‡è¦çš„æ“ä½œå†å²
2. **ç›‘æ§å¤§å°**: å…³æ³¨æ—¥å¿—æ–‡ä»¶å¢é•¿ï¼Œå¿…è¦æ—¶è°ƒæ•´è½®è½¬ç­–ç•¥
3. **åˆ†æå·¥å…·**: å¯ä½¿ç”¨ `jq` ç­‰å·¥å…·åˆ†æ JSON æ ¼å¼çš„æ—¥å¿—
4. **åˆè§„éœ€æ±‚**: æ ¹æ®ç»„ç»‡è¦æ±‚ç¡®å®šæ—¥å¿—ä¿ç•™å‘¨æœŸ

## ç¤ºä¾‹æŸ¥è¯¢

### æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“æ“ä½œ
```bash
grep "database_management" audit.log | jq .
```

### ç»Ÿè®¡å‘é‡æ“ä½œ
```bash
grep "vector_data" audit.log | jq .vector_count | paste -sd+ | bc
```

### æŸ¥çœ‹ç‰¹å®šç”¨æˆ·æ“ä½œ
```bash
grep "user_c638833" audit.log | jq .
``` 